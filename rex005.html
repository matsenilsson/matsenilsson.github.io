<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Mats E. Nilsson" />


<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 52px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 57px;
  margin-top: -57px;
}

.section h2 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h3 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h4 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h5 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h6 {
  padding-top: 57px;
  margin-top: -57px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">learn R by EXample</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="content.html">Content</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Seminar notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="rex001.html">001</a>
    </li>
    <li>
      <a href="rex002.html">002</a>
    </li>
    <li>
      <a href="rex003.html">003</a>
    </li>
    <li>
      <a href="rex004.html">004</a>
    </li>
    <li>
      <a href="rex005.html">005</a>
    </li>
    <li>
      <a href="rex006.html">006</a>
    </li>
    <li>
      <a href="rex101.html">101</a>
    </li>
    <li>
      <a href="rex102.html">102</a>
    </li>
    <li>
      <a href="rex103.html">103</a>
    </li>
    <li>
      <a href="rex104.html">104</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p>   </p>
<div id="notes-rex005" class="section level1">
<h1>Notes REX005</h1>
<p>We have already generated a lot of random numbers using R. Today some more details on how this works, before we continue with our simulated experiment.</p>
<p> </p>
<div id="random-numbers" class="section level2">
<h2>Random numbers</h2>
<p>Computers cannot generate true randomness. What you get is pseudo-random numbers. Fortunately, these behave almost exactly as truly random numbers so most users, including us, will not notice the difference. A good thing we pseudo-randomness is that it allows us to make our analyses reproducible, using the <code>set.seed()</code> function:</p>
<pre class="r"><code>set.seed(13)  # Use any integer as argument
rnorm(5)  # Random numbers</code></pre>
<pre><code>## [1]  0.5543269 -0.2802719  1.7751634  0.1873201  1.1425261</code></pre>
<pre class="r"><code>rnorm(5)  # New numbers</code></pre>
<pre><code>## [1]  0.4155261  1.2295066  0.2366797 -0.3653828  1.1051443</code></pre>
<pre class="r"><code>set.seed(13)
rnorm(5)  # Same as first above</code></pre>
<pre><code>## [1]  0.5543269 -0.2802719  1.7751634  0.1873201  1.1425261</code></pre>
<p>Any script generating random numbers should set the seed at the beginning to assure that you or someone else can reproduce the results. The use of random number generators for statistical data analysis has increased markedly with the popularity of resampling methods, e.g., bootstrapping. If you are conducting such analyses, don’t forget to set the seed.</p>
<p> </p>
<div id="random-number-generators" class="section level3">
<h3>Random number generators</h3>
<p>So far, we have used two random-number generators, <code>sample()</code> and <code>rnorm()</code>. The first let us sample with or without replacement from any vector (int, num, cha, or logi), irrespective of the distribution of values in that vector. The second samples from a normal distribution of infinite size (so sampling with or without replacement is not an issue). R has random number generators for a large set of probability distributions. This code uses three of these.</p>
<pre class="r"><code>n &lt;- 10^5
a &lt;- rnorm(n)
b &lt;- rexp(n)
c &lt;- runif(n)
par(mfrow = c(1,3))  # Locate three subplots in one row
hist(a, main = &#39;Normal&#39;)
hist(b, main = &#39;Exponential&#39;)
hist(c, main = &#39;Uniform&#39;)</code></pre>
<p><img src="rex005_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p> </p>
</div>
<div id="model-simulation-using-random-numbers" class="section level3">
<h3>Model simulation using random numbers</h3>
<p>This is a causal model of the relationship between three variables, intelligence (iq), social skills (ss) and income:</p>
<p><span class="math inline">\(iq\rightarrow{income}\leftarrow{ss}\)</span>.</p>
<p>In words: intelligence and social skills are independent and both influence income. To be more specific, we may assume that the causal effects leads to a linear relationship between social skills on the one hand and iq and ss on the other:<br />
<span class="math inline">\(income = \beta_0 + \beta_1iq + \beta_2ss +\epsilon\)</span></p>
<p>Below a simulation of this linear model, using random numbers drawn from the standard normal distribution (mean = 0, sd = 1, default values of <code>rnorm()</code>).</p>
<pre class="r"><code>set.seed(123)
# One possible set of beta weights
betaw &lt;- c(0, 0.5, 0.5) 
# Sample size
n = 10^4
# Random numbers representing iq
iq &lt;- rnorm(n)  
# Random numbers representing ss
ss &lt;- rnorm(n) 
# Income influenced by both iq and ss (added to &#39;baseline&#39; income)
income &lt;- betaw[1] + betaw[2] * iq + betaw[3] * ss + rnorm(n)  
simul &lt;- data.frame(iq, ss, income)  # Put all in a data frame (not necessary)</code></pre>
<p>A scatter plot matrix and a correlation matrix suggest that our simulation is consistent with the model: iq and ss are independent, and both are positively correlated with income.</p>
<pre class="r"><code>pairs(~simul$iq + simul$ss + simul$income)  # Scatter plot matrix</code></pre>
<p><img src="rex005_files/figure-html/unnamed-chunk-4-1.png" width="480" /></p>
<pre class="r"><code>round(cor(simul), 3)  # Pearson coefficients of correlation (to 3 decimals)</code></pre>
<pre><code>##           iq    ss income
## iq     1.000 0.006  0.424
## ss     0.006 1.000  0.406
## income 0.424 0.406  1.000</code></pre>
<p>As expected, a multiple regression model will recover the beta coefficients, plus minus some random error.</p>
<pre class="r"><code>lm(simul$income ~ simul$iq + simul$ss)</code></pre>
<pre><code>## 
## Call:
## lm(formula = simul$income ~ simul$iq + simul$ss)
## 
## Coefficients:
## (Intercept)     simul$iq     simul$ss  
##   -0.007081     0.520061     0.496815</code></pre>
<p>We may use this simulated data to illustrate <em>Collider stratification bias</em> (e.g., Elwert &amp; Winship, 2014. Endogenous selection bias: the problem of conditioning on a collider variable. <em>Annual Review of Sociology</em>, 40, 31-53).</p>
<p>A researcher is interested in the relationship between intelligence and social skills. His hypothesis is that intelligent individuals tend to spend time on reading books and other solitary tasksand therefore have less time to develop their social skills. He therefore predicts a negative correlation between intelligence (iq) and social skills (ss), and test this on a sample of people with similar income. He considers this to be a strength of his designs as it controls for income by restriction. The code generates a plot that shows the relationship between iq and ss in the full sample (open symbols, black line) and restricted to high-income people (blue symbols, blue line).</p>
<pre class="r"><code>plot(simul$iq, simul$ss, xlab = &#39;Intelligence (iq)&#39;, ylab = &#39;Social skills (ss)&#39;)

# Regression based on all data
full_model &lt;- lm(simul$ss ~ simul$iq)
abline(full_model)

# Regression based on restricted data
points(simul$iq[simul$income &gt; 2], simul$ss[simul$income &gt; 2],
       col = &#39;blue&#39;, pch = 16, cex = 0.5)
restricted_model &lt;- lm(simul$ss[simul$income &gt; 2] ~ simul$iq[simul$income &gt; 2])
abline(restricted_model, col = &#39;blue&#39;)</code></pre>
<p><img src="rex005_files/figure-html/unnamed-chunk-6-1.png" width="480" /></p>
<p>The restricted data (blue symbols and line) support the researcher’s hypothesis. But we know he’s wrong, because iq and ss are independent (by assumption). This is an example where controlling or adjusting for a potentially cofounding variable introduces bias. Note that it is true that there is a negative correlation between iq and ss in high-income individuals (in our simulated world); it’s the researcher’s <em>causal</em> hypothesis that is wrong, not his prediction of a negative correlation.</p>
<p> </p>
</div>
</div>
<div id="script-1-randomized-experiment-continued" class="section level2">
<h2>Script 1: Randomized experiment (continued)</h2>
<p>Click <a href="script1_4.R" target="_blank">for</a> Script1 as we left it after the last seminar.</p>
<p>Today we will complicate things by introducing non-compliance. Specifically:</p>
<ol style="list-style-type: decimal">
<li>Define ‘never-takers’ (participants who will not receive treatment no matter if they are assigned or not to treatment),</li>
<li>Simulate that risk for being a never-taker is related to both treatment and outcome</li>
<li>Explore what this means for the validity of as-treated and intent-to-treat analysis.</li>
</ol>
<p> </p>
<div id="exercises" class="section level3">
<h3>Exercises</h3>
<p>In our scenario, the only way to receive treatment (extra music lessons) is to be assigned to the treatment group. This means that there can only be two types of participants: compliers and never-takers. In other scenarios, all four types are possible: compliers, never-takers, always-takers and defiers.</p>
<ol style="list-style-type: decimal">
<li><p>Assume a positive causal effect of treatment on outcome. What happens (asymptotically) to the as-treated and intent-to-treat causal estimates in the four extreme scenarios with only one type of individuals.</p></li>
<li><p>Write code that simulates a scenario in which all four types exists in plausible proportions and relationships with socio-economic status.<br />
Explore what happens to the as-treated and intent-to-treat causal estimates in your new scenario.</p></li>
</ol>
<p>   </p>
</div>
</div>
</div>



<span style = grey>
<hr>
<p>&copy Mats E. Nilsson<br>Gösta Ekman Laboratory, 
Department of Psychology, Stockholm University</p>

</span>



</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
